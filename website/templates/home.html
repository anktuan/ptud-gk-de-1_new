{% extends 'base.html' %} {% block content %}
<div class="container">
  <div class="text-center">
    <h2 class="mb-3"><i class="fa-solid fa-rss"></i> Danh S√°ch B√†i Vi·∫øt</h2>
  </div>

  <!-- Flow Navigation -->
  <div class="flow-navigation mb-4 text-center">
    <a href="{{ url_for('views.flow_posts', flow_type='news') }}" class="btn btn-outline-primary me-2">
      <i class="fas fa-newspaper"></i> Tin t·ª©c
    </a>
    <a href="{{ url_for('views.flow_posts', flow_type='tutorial') }}" class="btn btn-outline-primary me-2">
      <i class="fas fa-book"></i> H∆∞·ªõng d·∫´n
    </a>
    <a href="{{ url_for('views.flow_posts', flow_type='review') }}" class="btn btn-outline-primary me-2">
      <i class="fas fa-star"></i> ƒê√°nh gi√°
    </a>
    <a href="{{ url_for('views.flow_posts', flow_type='other') }}" class="btn btn-outline-primary me-2">
      <i class="fas fa-folder"></i> Kh√°c
    </a>
  </div>

  <div class="card p-3">
    <div class="row" id="post-list">
      <!-- D·ªØ li·ªáu b√†i vi·∫øt s·∫Ω ƒë∆∞·ª£c load b·∫±ng AJAX -->
    </div>

    <!-- Pagination -->
    <nav class="mt-3">
      <ul class="pagination justify-content-center">
        <li class="page-item">
          <button id="prev-page" class="page-link" disabled>
            <i class="fa-solid fa-arrow-left"></i> Tr∆∞·ªõc
          </button>
        </li>
        <li class="page-item disabled">
          <span id="page-info" class="page-link">Trang 1</span>
        </li>
        <li class="page-item">
          <button id="next-page" class="page-link">
            Ti·∫øp <i class="fa-solid fa-arrow-right"></i>
          </button>
        </li>
      </ul>
    </nav>
  </div>
</div>

<script>
  let currentPage = 1;
  const postList = document.getElementById("post-list");
  const pageInfo = document.getElementById("page-info");
  const prevPageBtn = document.getElementById("prev-page");
  const nextPageBtn = document.getElementById("next-page");

  function getFlowBadge(flow) {
    const badges = {
      'news': '<span class="badge bg-info">Tin t·ª©c</span>',
      'tutorial': '<span class="badge bg-success">H∆∞·ªõng d·∫´n</span>',
      'review': '<span class="badge bg-warning">ƒê√°nh gi√°</span>',
      'other': '<span class="badge bg-secondary">Kh√°c</span>'
    };
    return flow ? badges[flow] : '';
  }

  function loadPosts(page) {
    fetch(`/api/posts?page=${page}&all=true`)
      .then((response) => response.json())
      .then((data) => {
        postList.innerHTML = "";
        data.posts.forEach((post) => {
          const flowBadge = getFlowBadge(post.flow);
          const imageHtml = post.image_url ? 
            `<img src="${post.image_url}" class="card-img-top mb-3" alt="·∫¢nh b√†i vi·∫øt" style="max-height: 200px; object-fit: cover;">` : '';
          
          postList.innerHTML += `
            <div class="col-md-6 mb-4">
              <div class="card shadow-sm h-100 d-flex flex-column">
                ${imageHtml}
                <div class="card-body d-flex flex-column">
                  <h5 class="card-title">${post.title}</h5>
                  <div class="mb-2">
                    ${flowBadge}
                  </div>
                  <p class="text-muted">
                    üë§ <strong>${post.author}</strong> | üìÖ ${post.updated_at}
                  </p>
                  <p class="card-text flex-grow-1">${post.content.substring(0, 150)}...</p>
                  
                  <!-- N√∫t "ƒê·ªçc ti·∫øp" lu√¥n n·∫±m d∆∞·ªõi c√πng -->
                  <a href="/post/${post.slug}" class="btn btn-secondary mt-auto">
                    <i class="fa-solid fa-eye"></i> ƒê·ªçc ti·∫øp
                  </a>
                </div>
              </div>
            </div>`;
        });

        pageInfo.innerText = `Trang ${page}`;
        currentPage = page;
        prevPageBtn.disabled = page <= 1;
        nextPageBtn.disabled = !data.has_next;
      });
  }

  prevPageBtn.addEventListener("click", () => {
    if (currentPage > 1) loadPosts(currentPage - 1);
  });

  nextPageBtn.addEventListener("click", () => {
    loadPosts(currentPage + 1);
  });

  loadPosts(1);
</script>
{% endblock %}